openapi: 3.0.3
info:
  title: MovieSwipe Auth API
  description: Authentication API for MovieSwipe application handling Google OAuth authentication
  version: 1.0.0
  contact:
    name: MovieSwipe Team
servers:
  - url: http://localhost:3000/api
    description: Development server

paths:
  /auth:
    post:
      summary: Authenticate user with Google
      description: |
        Authenticates a user using Google OAuth ID token. If the user doesn't exist, 
        they will be automatically registered. Returns a JWT token for subsequent API calls.
      operationId: authenticateWithGoogle
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthenticateUserRequest'
            examples:
              validRequest:
                summary: Valid Google ID token
                value:
                  idToken: 'eyJhbGciOiJSUzI1NiIsImtpZCI6IjE2NzAyNzUyMzg5...example_google_id_token'
      responses:
        '201':
          description: User authenticated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthenticateUserResponse'
              examples:
                successfulAuth:
                  summary: Successful authentication response
                  value:
                    message: 'User signed up successfully'
                    data:
                      token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...jwt_token'
                      user:
                        _id: '65a1b2c3d4e5f6789012345'
                        googleId: '1234567890'
                        email: 'user@example.com'
                        name: 'John Doe'
                        createdAt: '2024-01-15T10:30:00.000Z'
                        updatedAt: '2024-01-15T10:30:00.000Z'
        '400':
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                validationError:
                  summary: Missing or invalid ID token
                  value:
                    message: 'Validation error'
                    errors:
                      - field: 'idToken'
                        message: 'Google token is required'
        '401':
          description: Unauthorized - invalid Google token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalidToken:
                  summary: Invalid Google ID token
                  value:
                    message: 'Invalid Google token'

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                processingError:
                  summary: Failed to process user information
                  value:
                    message: 'Failed to process user information'
                serverError:
                  summary: Internal server error
                  value:
                    message: 'Internal server error'

components:
  schemas:
    AuthenticateUserRequest:
      type: object
      required:
        - idToken
      properties:
        idToken:
          type: string
          description: Google OAuth ID token obtained from Google Sign-In
          minLength: 1
          example: 'eyJhbGciOiJSUzI1NiIsImtpZCI6IjE2NzAyNzUyMzg5...example_google_id_token'

    AuthenticateUserResponse:
      type: object
      required:
        - message
      properties:
        message:
          type: string
          description: Response message
          example: 'User signed up successfully'
        data:
          $ref: '#/components/schemas/AuthResult'

    AuthResult:
      type: object
      required:
        - token
        - user
      properties:
        token:
          type: string
          description: JWT token for authentication
          example: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...jwt_token'
        user:
          $ref: '#/components/schemas/User'

    User:
      type: object
      required:
        - _id
        - googleId
        - email
        - name
        - createdAt
        - updatedAt
      properties:
        _id:
          type: string
          description: MongoDB ObjectId as string
          example: '65a1b2c3d4e5f6789012345'
        googleId:
          type: string
          description: Google user ID
          example: '1234567890'
        email:
          type: string
          format: email
          description: User's email address
          example: 'user@example.com'
        name:
          type: string
          description: User's full name
          example: 'John Doe'
        createdAt:
          type: string
          format: date-time
          description: Account creation timestamp
          example: '2024-01-15T10:30:00.000Z'
        updatedAt:
          type: string
          format: date-time
          description: Last update timestamp
          example: '2024-01-15T10:30:00.000Z'

    ErrorResponse:
      type: object
      required:
        - message
      properties:
        message:
          type: string
          description: Error message
          example: 'Invalid Google token'
        errors:
          type: array
          description: Detailed validation errors (when applicable)
          items:
            type: object
            properties:
              field:
                type: string
                description: Field that caused the error
                example: 'idToken'
              message:
                type: string
                description: Specific error message for the field
                example: 'Google token is required'

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from authentication endpoint

security: []

tags:
  - name: Authentication
    description: User authentication operations using Google OAuth
